"use strict";(self.webpackChunkpayment_doc=self.webpackChunkpayment_doc||[]).push([[967],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),u=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(a),m=n,d=c["".concat(l,".").concat(m)]||c[m]||h[m]||i;return a?r.createElement(d,o(o({ref:t},p),{},{components:a})):r.createElement(d,o({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:n,o[1]=s;for(var u=2;u<i;u++)o[u]=a[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8770:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var r=a(7462),n=(a(7294),a(3905));const i={sidebar_position:2},o=void 0,s={unversionedId:"Web hooks/Authenticate Webhook Requests",id:"Web hooks/Authenticate Webhook Requests",title:"Authenticate Webhook Requests",description:"Relworx signs webhook requests so you can (optionally) verify that requests are generated by Relworx and not a third-party pretending to be Relworx. If your application exposes sensitive data, you may want to be sure the requests are coming from Relworx. This isn't required, but offers an additional layer of verification.",source:"@site/docs/Web hooks/Authenticate Webhook Requests.md",sourceDirName:"Web hooks",slug:"/Web hooks/Authenticate Webhook Requests",permalink:"/Web hooks/Authenticate Webhook Requests",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Web Hooks",permalink:"/Web hooks/"},next:{title:"API Version",permalink:"/API Version"}},l={},u=[{value:"Verifying Request Signatures",id:"verifying-request-signatures",level:4},{value:"Get your webhook authentication key",id:"get-your-webhook-authentication-key",level:4},{value:"Generate a signature",id:"generate-a-signature",level:3},{value:"Sample PHP implementation to generate verification signature:",id:"sample-php-implementation-to-generate-verification-signature",level:4}],p={toc:u},c="wrapper";function h(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Relworx signs webhook requests so you can (optionally) verify that requests are generated by Relworx and not a third-party pretending to be Relworx. If your application exposes sensitive data, you may want to be sure the requests are coming from Relworx. This isn't required, but offers an additional layer of verification."),(0,n.kt)("h4",{id:"verifying-request-signatures"},"Verifying Request Signatures"),(0,n.kt)("p",null,"Relworx includes an additional HTTP header with webhook POST requests, Relworx-Signature, which will contain the signature for the request. To verify a webhook request, generate a signature using the same key that Relworx uses and compare that to the value of the Relworx-Signature header."),(0,n.kt)("h4",{id:"get-your-webhook-authentication-key"},"Get your webhook authentication key"),(0,n.kt)("p",null,"When you create a business account, a key is automatically generated. You can also view and reset the key from the settings section on your business account view page."),(0,n.kt)("h3",{id:"generate-a-signature"},"Generate a signature"),(0,n.kt)("p",null,"In your code that receives or processes webhook requests:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create a string with the webhook's URL, exactly as you entered it (including any query strings, if applicable). Relworx always signs webhook requests with the exact callback URL you provided for your request. A difference as small as including or removing a trailing slash will prevent the signature from validating.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Extract the timestamp and signature from the header. Relworx includes a timestamp in the Relworx-Signature header to mitigate replay attacks. A replay attack is when an attacker intercepts a valid payload and its signature, then re-transmits them. Because this timestamp is part of the signed payload, it is also verified by the signature, so an attacker cannot change the timestamp without invalidating the signature. If the signature is valid but the timestamp is too old, you can have your application reject the payload. Split the header, using the , character as the separator, to get a list of elements. Then split each element, using the = character as the separator, to get a prefix and value pair. The value for the prefix t corresponds to the timestamp, and v corresponds to the signature. Sample Relworx-Signature ",(0,n.kt)("inlineCode",{parentName:"p"},'"relworx-signature": "t=1561370460,v=fgrSxEFI/z6Twr6xZogRYnKCfew="'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Concatenate signature timestamp to webhook URL.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Sort the request's POST variables alphabetically by key. Append each POST variable's key and value to the URL string, with no delimiter. Only include POST variables shown in sample code. status, ",(0,n.kt)("inlineCode",{parentName:"p"},"customer_reference, internal_reference"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Hash the resulting string with HMAC-SHA256, using your webhook signing key to generate a hex-encoded signature.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Compare the hex-encoded signature that you generated to the signature provided in the Relworx-Signature HTTP header."))),(0,n.kt)("h4",{id:"sample-php-implementation-to-generate-verification-signature"},"Sample PHP implementation to generate verification signature:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * @param string $webhook_key the webhooks authentication key\n * @param string $url the webhook url\n * @param string $timestamp the signature timestamp\n * @param array $params the requests POST parameters\n */\n\n//Only include these from POST data\n$params = array(\n  "status" => "success",\n  "customer_reference" => "shdfjsue789sh8jshuehu",\n  "internal_reference" => "jshfufehkshffkseuhfskahakhuefak",\n);\n\nfunction generateSignature($webhook_key, $timestamp, $url, $params) {\n    $signed_data = $url;\n    $signed_data .= $timestamp;\n    ksort($params);\n    foreach ($params as $key => $value) {\n        $signed_data .= strval($key);\n        $signed_data .= strval($value);\n    }\n\n    return hash_hmac(\'sha256\', $signed_data, $webhook_key, false);\n}\n')))}h.isMDXComponent=!0}}]);